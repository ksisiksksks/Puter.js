<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apex AI - Ultimate</title>
    
    <script src="https://js.puter.com/v2/"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        brand: { 500: '#6366f1', 600: '#4f46e5' }, // Indigo Premium
                        dark: { 900: '#0f172a', 800: '#1e293b', 700: '#334155' }
                    }
                }
            }
        }
    </script>

    <style>
        /* CSS RESET & TWEAKS */
        body { background-color: #0f172a; color: white; -webkit-tap-highlight-color: transparent; }
        .hidden-screen { display: none !important; }
        
        /* Glassmorphism */
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-top: 1px solid rgba(255,255,255,0.1); }
        
        /* Scrollbar Halus */
        ::-webkit-scrollbar { width: 0px; background: transparent; } /* Hidden scrollbar for cleaner look */
        
        /* Animation */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Markdown */
        .prose p { margin-bottom: 0.5em; font-size: 0.95rem; line-height: 1.6; }
        .prose strong { color: #818cf8; }
        .prose code { background: #334155; padding: 2px 5px; rounded: 4px; font-family: monospace; font-size: 0.85em; }
        .prose pre { background: #020617; padding: 10px; rounded: 8px; overflow-x: auto; margin-top: 8px; border: 1px solid #1e293b; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-brand-500 selection:text-white">

    <div id="auth-screen" class="fixed inset-0 z-50 bg-[#0f172a] flex items-center justify-center p-6">
        <div class="absolute inset-0 overflow-hidden">
            <div class="absolute -top-[20%] -left-[10%] w-[50%] h-[50%] bg-brand-500/20 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-[0%] right-[0%] w-[40%] h-[40%] bg-purple-500/20 rounded-full blur-[100px]"></div>
        </div>

        <div class="w-full max-w-sm relative z-10 fade-in">
            <div class="text-center mb-10">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-tr from-brand-600 to-purple-600 shadow-2xl shadow-brand-500/30 mb-4">
                    <i class="ri-openai-fill text-3xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-white tracking-tight">Apex AI</h1>
                <p class="text-slate-400 text-sm mt-2">Masuk untuk melanjutkan ke Workspace</p>
            </div>

            <div class="bg-dark-800/50 border border-slate-700/50 backdrop-blur-xl p-6 rounded-2xl shadow-xl space-y-4">
                <div>
                    <label class="text-xs font-semibold text-slate-400 uppercase ml-1">Email</label>
                    <input type="email" id="email" class="w-full bg-dark-900/50 border border-slate-700 rounded-xl px-4 py-3 mt-1 text-white focus:outline-none focus:border-brand-500 focus:ring-1 focus:ring-brand-500 transition-all placeholder-slate-600" placeholder="nama@email.com">
                </div>
                <div>
                    <label class="text-xs font-semibold text-slate-400 uppercase ml-1">Password</label>
                    <input type="password" id="password" class="w-full bg-dark-900/50 border border-slate-700 rounded-xl px-4 py-3 mt-1 text-white focus:outline-none focus:border-brand-500 transition-all placeholder-slate-600" placeholder="••••••••">
                </div>
                <button onclick="handleLogin()" id="login-btn" class="w-full bg-brand-600 hover:bg-brand-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-brand-600/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                    <span>Masuk Akun</span>
                    <i class="ri-arrow-right-line"></i>
                </button>
            </div>
            <p class="text-center text-xs text-slate-500 mt-6">Belum punya akun? <span class="text-brand-500 cursor-pointer font-bold">Daftar (Gratis)</span></p>
        </div>
    </div>

    <div id="app-screen" class="hidden-screen flex h-full relative bg-[#0f172a]">
        
        <div class="hidden md:flex flex-col w-72 border-r border-slate-800 bg-dark-900/50 backdrop-blur-xl">
            <div class="p-6 border-b border-slate-800/50">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-brand-600 flex items-center justify-center text-white font-bold shadow-lg shadow-brand-500/30">A</div>
                    <div>
                        <h2 class="font-bold text-base leading-tight">Apex AI</h2>
                        <span class="text-[10px] px-1.5 py-0.5 rounded bg-brand-500/10 text-brand-400 border border-brand-500/20">PRO v7.0</span>
                    </div>
                </div>
            </div>

            <div class="flex-1 p-4 space-y-1">
                <button onclick="switchTab('chat')" id="nav-chat-d" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all bg-brand-600 text-white">
                    <i class="ri-chat-4-line text-lg"></i> Chat AI
                </button>
                <button onclick="switchTab('video')" id="nav-video-d" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                    <i class="ri-movie-line text-lg"></i> Video Studio <span class="ml-auto text-[9px] bg-purple-500 text-white px-1 rounded">SORA</span>
                </button>
                <button onclick="switchTab('gallery')" id="nav-gallery-d" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-slate-400 hover:bg-slate-800 hover:text-white transition-all">
                    <i class="ri-gallery-line text-lg"></i> Galeri
                </button>
            </div>

            <div class="p-4 border-t border-slate-800/50">
                <div class="flex items-center gap-3 p-3 rounded-xl bg-slate-800/50 border border-slate-700/50">
                    <div class="w-9 h-9 rounded-full bg-gradient-to-tr from-blue-500 to-cyan-500 flex items-center justify-center font-bold text-xs" id="avatar-sidebar">U</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-bold truncate" id="username-sidebar">User</p>
                        <p class="text-[10px] text-green-400">● Online</p>
                    </div>
                    <button onclick="logout()" class="text-slate-400 hover:text-red-400"><i class="ri-logout-box-r-line"></i></button>
                </div>
            </div>
        </div>

        <div class="flex-1 flex flex-col relative overflow-hidden">
            
            <div class="md:hidden h-14 border-b border-slate-800 flex items-center justify-between px-4 glass z-20 sticky top-0">
                <div class="flex items-center gap-2">
                    <div class="w-7 h-7 rounded bg-brand-600 flex items-center justify-center text-white text-xs font-bold">A</div>
                    <span class="font-bold text-sm" id="page-title">Apex Chat</span>
                </div>
                <button onclick="logout()" class="text-slate-400"><i class="ri-logout-box-r-line"></i></button>
            </div>

            <div id="view-chat" class="flex-1 flex flex-col h-full absolute inset-0 pt-14 md:pt-0 z-10 bg-[#0f172a]">
                <div id="chat-container" class="flex-1 overflow-y-auto p-4 pb-24 space-y-6">
                    <div class="h-full flex flex-col items-center justify-center text-slate-600 opacity-50 space-y-4">
                        <i class="ri-openai-fill text-5xl"></i>
                        <p class="text-sm font-medium">Apex AI Ready</p>
                    </div>
                </div>

                <div class="absolute bottom-0 w-full p-4 glass md:bg-[#0f172a] md:border-t md:border-slate-800 pb-20 md:pb-4">
                    <div id="img-preview-box" class="hidden absolute bottom-full left-4 mb-2 p-1 bg-slate-800 rounded-lg border border-slate-700 shadow-xl">
                        <img id="img-preview" src="" class="h-16 rounded object-cover">
                        <button onclick="clearFile()" class="absolute -top-2 -right-2 bg-red-500 rounded-full w-5 h-5 flex items-center justify-center text-xs"><i class="ri-close-line"></i></button>
                    </div>

                    <div class="max-w-3xl mx-auto flex items-end gap-2 bg-slate-900 border border-slate-700 p-1.5 rounded-2xl shadow-lg focus-within:border-brand-500 transition-colors">
                        <button onclick="document.getElementById('file-upload').click()" class="p-3 text-slate-400 hover:text-brand-400 rounded-xl hover:bg-slate-800 transition">
                            <i class="ri-image-add-line text-xl"></i>
                        </button>
                        <input type="file" id="file-upload" class="hidden" accept="image/*" onchange="handleFile(this)">

                        <textarea id="user-input" rows="1" class="flex-1 bg-transparent text-white placeholder-slate-500 text-sm py-3 focus:outline-none resize-none max-h-32" placeholder="Ketik pesan..."></textarea>
                        
                        <button onclick="sendMessage()" class="p-3 bg-brand-600 hover:bg-brand-500 text-white rounded-xl shadow-lg shadow-brand-600/20 transition active:scale-95">
                            <i class="ri-send-plane-fill text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div id="view-video" class="hidden-screen flex-1 flex flex-col h-full absolute inset-0 pt-14 md:pt-0 bg-[#0f172a] z-10 overflow-y-auto">
                <div class="p-6 max-w-2xl mx-auto w-full space-y-6 pb-24">
                    <div class="text-center space-y-2 mt-4">
                        <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-brand-400 bg-clip-text text-transparent">Video Studio</h2>
                        <p class="text-slate-400 text-sm">Generate video pendek menggunakan AI (Beta)</p>
                    </div>

                    <div class="bg-slate-800/50 border border-slate-700 rounded-2xl p-4 space-y-4">
                        <textarea id="video-prompt" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-sm text-white focus:border-purple-500 focus:outline-none h-24 resize-none" placeholder="Deskripsikan video: Seekor kucing astronot melayang di angkasa..."></textarea>
                        <button onclick="generateVideo()" id="gen-vid-btn" class="w-full bg-gradient-to-r from-purple-600 to-brand-600 hover:from-purple-500 hover:to-brand-500 text-white font-bold py-3 rounded-xl shadow-lg transition flex items-center justify-center gap-2">
                            <i class="ri-movie-2-ai-line"></i> Generate Video
                        </button>
                    </div>

                    <div id="video-result" class="hidden space-y-3">
                        <h3 class="text-sm font-bold text-slate-300">Hasil:</h3>
                        <div class="relative w-full aspect-video bg-black rounded-xl overflow-hidden border border-slate-700 shadow-2xl">
                            <img id="generated-video-src" src="" class="w-full h-full object-cover">
                            <div class="absolute bottom-2 right-2 bg-black/60 px-2 py-1 rounded text-[10px] text-white backdrop-blur">AI GENERATED</div>
                        </div>
                        <button onclick="alert('Video disimpan ke galeri!')" class="w-full bg-slate-800 hover:bg-slate-700 text-sm py-3 rounded-xl border border-slate-700 transition">
                            <i class="ri-download-line"></i> Simpan ke Galeri
                        </button>
                    </div>
                </div>
            </div>

            <div id="view-gallery" class="hidden-screen flex-1 absolute inset-0 pt-14 md:pt-0 bg-[#0f172a] z-10 overflow-y-auto p-6 pb-24">
                <h2 class="text-xl font-bold mb-4">Galeri Tersimpan</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3" id="gallery-grid">
                    <div class="aspect-square bg-slate-800 rounded-xl border border-slate-700 flex items-center justify-center text-slate-600"><i class="ri-image-line"></i></div>
                    <div class="aspect-square bg-slate-800 rounded-xl border border-slate-700 flex items-center justify-center text-slate-600"><i class="ri-image-line"></i></div>
                </div>
            </div>
        </div>

        <div class="md:hidden fixed bottom-0 w-full bg-[#0f172a]/90 backdrop-blur-lg border-t border-slate-800 z-50 pb-safe">
            <div class="flex justify-around items-center h-16">
                <button onclick="switchTab('chat')" id="nav-chat-m" class="flex flex-col items-center justify-center w-full h-full text-brand-500">
                    <i class="ri-chat-4-fill text-xl mb-0.5"></i>
                    <span class="text-[10px] font-medium">Chat</span>
                </button>
                <button onclick="switchTab('video')" id="nav-video-m" class="flex flex-col items-center justify-center w-full h-full text-slate-500">
                    <i class="ri-movie-fill text-xl mb-0.5"></i>
                    <span class="text-[10px] font-medium">Video</span>
                </button>
                <button onclick="switchTab('gallery')" id="nav-gallery-m" class="flex flex-col items-center justify-center w-full h-full text-slate-500">
                    <i class="ri-gallery-fill text-xl mb-0.5"></i>
                    <span class="text-[10px] font-medium">Galeri</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        const authScreen = document.getElementById('auth-screen');
        const appScreen = document.getElementById('app-screen');
        const chatBox = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        
        let currentUser = localStorage.getItem('apex_user');
        let currentImage = null;

        // --- AUTH LOGIC (REAL FEEL) ---
        function init() {
            if (currentUser) {
                // Auto Login
                currentUser = JSON.parse(currentUser);
                showApp();
            }
        }

        function handleLogin() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const btn = document.getElementById('login-btn');

            if(!email || !pass) return alert("Harap isi email dan password!");

            // Animasi Loading Server
            btn.innerHTML = `<i class="ri-loader-4-line animate-spin text-xl"></i>`;
            
            setTimeout(() => {
                // Simulasi Sukses
                currentUser = {
                    email: email,
                    name: email.split('@')[0],
                    avatar: email.charAt(0).toUpperCase()
                };
                localStorage.setItem('apex_user', JSON.stringify(currentUser));
                showApp();
            }, 1500);
        }

        function showApp() {
            authScreen.classList.add('hidden-screen');
            appScreen.classList.remove('hidden-screen');
            // Set Profil Sidebar
            document.getElementById('username-sidebar').innerText = currentUser.name;
            document.getElementById('avatar-sidebar').innerText = currentUser.avatar;
        }

        function logout() {
            if(confirm("Keluar dari Apex AI?")) {
                localStorage.removeItem('apex_user');
                location.reload();
            }
        }

        // --- NAVIGATION LOGIC (SPA) ---
        function switchTab(tab) {
            // Hide all views
            document.getElementById('view-chat').classList.add('hidden-screen');
            document.getElementById('view-video').classList.add('hidden-screen');
            document.getElementById('view-gallery').classList.add('hidden-screen');
            
            // Reset Nav Colors (Mobile & Desktop)
            const navs = ['chat', 'video', 'gallery'];
            navs.forEach(t => {
                // Mobile
                const iconM = document.querySelector(`#nav-${t}-m i`);
                const textM = document.querySelector(`#nav-${t}-m span`);
                document.getElementById(`nav-${t}-m`).classList.remove('text-brand-500');
                document.getElementById(`nav-${t}-m`).classList.add('text-slate-500');
                if(iconM) iconM.className = iconM.className.replace('-fill', '-line'); // Change icon style

                // Desktop
                document.getElementById(`nav-${t}-d`).classList.remove('bg-brand-600', 'text-white');
                document.getElementById(`nav-${t}-d`).classList.add('text-slate-400', 'hover:bg-slate-800');
            });

            // Show selected view
            document.getElementById(`view-${tab}`).classList.remove('hidden-screen');
            
            // Active State Mobile
            const activeM = document.getElementById(`nav-${tab}-m`);
            activeM.classList.remove('text-slate-500');
            activeM.classList.add('text-brand-500');
            const activeIconM = activeM.querySelector('i');
            activeIconM.className = activeIconM.className.replace('-line', '-fill');

            // Active State Desktop
            const activeD = document.getElementById(`nav-${tab}-d`);
            activeD.classList.remove('text-slate-400', 'hover:bg-slate-800');
            activeD.classList.add('bg-brand-600', 'text-white');

            // Update Header Title (Mobile)
            const titles = { 'chat': 'Apex Chat', 'video': 'Video Studio', 'gallery': 'Galeri' };
            document.getElementById('page-title').innerText = titles[tab];
        }

        // --- CHAT FEATURE ---
        userInput.addEventListener('keydown', (e) => {
            if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
        });

        async function sendMessage() {
            const text = userInput.value.trim();
            if(!text && !currentImage) return;

            // Bersihkan welcome
            if(chatBox.querySelector('.ri-openai-fill')) chatBox.innerHTML = '';

            const userText = text; 
            const userImg = currentImage;

            appendBubble('user', userText, userImg);
            userInput.value = '';
            clearFile();

            // Loading
            const loadingId = showLoading();

            try {
                let prompt = "";
                if(userImg) prompt = `[SYSTEM: User uploaded image. Context: ${userText || "Analyze this image"}]`; 
                else prompt = `User: ${userText}`;

                const response = await puter.ai.chat(prompt);
                removeLoading(loadingId);
                
                let aiText = typeof response === 'object' ? response.message.content : response.toString();
                appendBubble('ai', aiText);

            } catch (err) {
                removeLoading(loadingId);
                appendBubble('system', "Koneksi Error.");
            }
        }

        function appendBubble(role, text, img) {
            const div = document.createElement('div');
            div.className = `flex gap-3 max-w-3xl mx-auto w-full mb-4 fade-in ${role === 'user' ? 'flex-row-reverse' : ''}`;
            
            let content = '';
            let imgHTML = img ? `<img src="${img}" class="rounded-lg mb-2 max-h-48 border border-slate-600">` : '';

            if (role === 'ai') {
                content = `
                    <div class="w-8 h-8 rounded-lg bg-brand-600 flex items-center justify-center shrink-0 mt-1"><i class="ri-openai-fill text-white"></i></div>
                    <div class="max-w-[85%] bg-slate-800/80 border border-slate-700 p-4 rounded-2xl rounded-tl-none text-sm text-slate-200 shadow-sm prose prose-invert">
                        ${marked.parse(text)}
                    </div>`;
            } else if (role === 'user') {
                content = `
                    <div class="max-w-[85%] bg-brand-600 text-white p-3 rounded-2xl rounded-tr-none text-sm shadow-md">
                        ${imgHTML}
                        <p>${text.replace(/\n/g, '<br>')}</p>
                    </div>`;
            } else { // System
                content = `<div class="w-full text-center text-xs text-red-400 bg-red-900/20 p-1 rounded">${text}</div>`;
            }

            div.innerHTML = content;
            chatBox.appendChild(div);
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        }

        function showLoading() {
            const id = 'load-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'flex gap-3 max-w-3xl mx-auto w-full mb-4';
            div.innerHTML = `
                <div class="w-8 h-8 rounded-lg bg-brand-600 flex items-center justify-center shrink-0"><i class="ri-openai-fill text-white"></i></div>
                <div class="bg-slate-800/50 border border-slate-700 p-3 rounded-2xl rounded-tl-none flex items-center gap-2">
                    <i class="ri-loader-4-line animate-spin text-brand-400"></i>
                    <span class="text-xs text-slate-400">Thinking...</span>
                </div>`;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
            return id;
        }
        function removeLoading(id) { const el = document.getElementById(id); if(el) el.remove(); }

        // --- FILE HANDLING ---
        function handleFile(input) {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentImage = e.target.result;
                    document.getElementById('img-preview').src = currentImage;
                    document.getElementById('img-preview-box').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }
        function clearFile() {
            currentImage = null;
            document.getElementById('file-upload').value = '';
            document.getElementById('img-preview-box').classList.add('hidden');
        }

        // --- VIDEO GEN (SIMULASI CANGGIH GIPHY) ---
        // Karena Sora API berbayar mahal, kita gunakan Giphy API sebagai demo "Video Gen"
        async function generateVideo() {
            const prompt = document.getElementById('video-prompt').value;
            const btn = document.getElementById('gen-vid-btn');
            
            if(!prompt) return alert("Isi deskripsi video dulu!");

            btn.disabled = true;
            btn.innerHTML = `<i class="ri-loader-fill animate-spin"></i> Generating (AI)...`;

            try {
                // Fetch GIF yang relevan dari GIPHY (Gratis)
                const res = await fetch(`https://api.giphy.com/v1/gifs/translate?api_key=0UTRbFtkMxAplrog07ovMn6GYesE4d8z&s=${prompt}`);
                const data = await res.json();
                
                setTimeout(() => {
                    document.getElementById('video-result').classList.remove('hidden');
                    document.getElementById('generated-video-src').src = data.data.images.original.url;
                    
                    btn.disabled = false;
                    btn.innerHTML = `<i class="ri-movie-2-ai-line"></i> Generate Video`;
                }, 2000); // Simulasi delay render

            } catch (err) {
                btn.disabled = false;
                btn.innerHTML = `Error. Coba Lagi`;
                alert("Gagal generate. Server busy.");
            }
        }

        // START
        init();
    </script>
</body>
</html>
